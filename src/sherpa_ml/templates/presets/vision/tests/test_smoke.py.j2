# tests/test_smoke.py.j2 (VISION)

import importlib
import pathlib
import subprocess
import sys

# Import path must match --pkg (defaults to repo_name with '-' -> '_')
PKG = "{{ (pkg or (repo_name | replace('-', '_'))) }}"

def project_root() -> pathlib.Path:
    # tests/ is under project root
    return pathlib.Path(__file__).resolve().parent.parent

def test_import():
    importlib.import_module(PKG)

def test_train_fast():
    root = project_root()
    proc = subprocess.run(
        [sys.executable, "-m", f"{PKG}.train"],
        cwd=root,
        capture_output=True,
        text=True,
    )
    assert proc.returncode == 0, proc.stderr
